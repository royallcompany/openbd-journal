/*! jquery.a11yTree */
!function(a,b,c,d){function e(b,c){this.element=b,this.treeIdPiece=this.element.id?"-"+this.element.id:"",this.options=a.extend({},Q,c),this.init()}function f(a,b){return a.which===b}var g="a11yTree",h="plugin_",i="ul",j="li",k="id",l="at",m="at-identity",n="-label",o="-n",p="tabindex",q="keydown",r="click",s="role",t="aria-level",u="tree",v="treeitem",w="group",x="aria-selected",y="aria-hidden",z="aria-expanded",A="aria-activedescendant",B="aria-labelledby",C='li[aria-expanded="true"]',D='[aria-selected="true"]',E="at-has-children",F="."+E,G="at-no-children",H="at-toggle",I="."+H,J=40,K=38,L=39,M=37,N=13,O=35,P=36,Q={treeLabelId:d,treeItemLabelSelector:d,toggleSelector:d,insertToggle:!0,customToggle:{html:d},onExpand:function(){},onCollapse:function(){}};e.prototype={init:function(){var b=a(this.element);this.identifyChildren(b,u,1),this.addTreeLabels(b),this.attachToggle(b),this.addMouseNav(b),this.addKeyBoardNav(b)},addIdToTreeLabels:function(b){var c=this,d=c.options.treeItemLabelSelector;if(d){var e=b.find(F);e.each(function(){var b=a(this),c=b.children(d).attr(k);c&&b.children(i).attr(B,c)})}},addTreeLabels:function(b){var c=this,d=c.options.treeLabelId;d&&a("#"+d).length>0&&b.attr(B,d),c.addIdToTreeLabels(b)},attachToggle:function(a){if(this.options.insertToggle!==!1){if(this.options.toggleSelector)a.find(this.options.toggleSelector).addClass(H).attr(y,"true");else{var b="";this.options.customToggle.html&&(b=this.options.customToggle.html),a.find(F).prepend('<div class="'+H+'" aria-hidden="true">'+b+"</div>")}this.attachToggleClick(a)}},attachToggleClick:function(b){var c=this;b.find(I).on(r,function(b){var d=a(this).parent(j);c.toggleExpandCollapse(d,b)})},addMouseNav:function(b){var c=this;b.find(j).click(function(d){d.stopPropagation(),c.focusOn(a(this),b)})},addKeyBoardNav:function(a){this.focusOn(this.findFirstListItem(a),a),this.addTreeToTabOrder(a),this.handleKeys(a)},handleKeys:function(a){var b=this;a.on(q,function(c){var d=a.find(D);f(c,J)?(c.preventDefault(),b.handleDownArrowKey(d,a)):f(c,K)?(c.preventDefault(),b.handleUpArrowKey(d,a)):f(c,L)?(c.preventDefault(),b.handleRightArrowKey(d,a,c)):f(c,M)?(c.preventDefault(),b.handleLeftArrowKey(d,a,c)):f(c,N)?b.handleEnterKey(d,c):f(c,O)?(c.preventDefault(),b.handleEndKey(d,a)):f(c,P)&&(c.preventDefault(),b.handleHomeKey(d,a))})},addTreeToTabOrder:function(a){a.attr(p,"0")},handleLeftArrowKey:function(a,b,c){this.isExpanded(a)?this.collapse(a,c):this.focusOn(this.findParent(a),b)},handleRightArrowKey:function(a,b,c){this.isCollapsed(a)?this.expand(a,c):this.isExpanded(a)&&this.focusOn(this.findFirstListItemInSubList(a),b)},handleUpArrowKey:function(a,b){var c=a.prev();this.isExpanded(c)?this.focusOnLastVisibleElementInTree(c.children(i),b):0===a.prev().length?this.focusOn(this.findParent(a),b):this.focusOn(a.prev(),b)},handleDownArrowKey:function(a,b){this.hasChildren(a)&&this.isExpanded(a)?this.focusOn(this.findFirstListItemInSubList(a),b):this.focusOnNextAvailableSiblingInTree(a,b)},handleEnterKey:function(a,b){this.toggleExpandCollapse(a,b)},handleEndKey:function(a,b){this.focusOnLastVisibleElementInTree(b)},handleHomeKey:function(a,b){this.focusOn(this.findFirstListItem(b),b)},hasChildren:function(a){return a.hasClass(E)},focusOn:function(a,b){1===a.length&&(b.find(j).attr(x,"false"),a.attr(x,"true"),b.attr(A,a.attr(k)))},focusOnNextAvailableSiblingInTree:function(a,b){0!==a.length&&(a.next().length>0?this.focusOn(a.next(),b):this.focusOnNextAvailableSiblingInTree(this.findParent(a),b))},focusOnLastVisibleElementInTree:function(a,b){var c=a.find(j).last(),d=c.parent(i);this.isParentTree(d)||(d=this.findClosestExpandedTree(a,c)),this.focusOn(this.findLastListItem(d),b||a)},findClosestExpandedTree:function(a,b){var c=b.parent(i).closest(C);if(0===c.length)return a;var d=c.parent(i).closest(j);return 0===d.length||this.isExpanded(d)?c.children(i):this.findClosestExpandedTree(a,c)},expand:function(a,b){this.options.onExpand&&this.options.onExpand(a,b),a.attr(z,"true")},collapse:function(a,b){this.options.onCollapse&&this.options.onCollapse(a,b),a.attr(z,"false")},isExpanded:function(a){return"true"===a.attr(z)},isCollapsed:function(a){return"false"===a.attr(z)},toggleExpandCollapse:function(a,b){this.isCollapsed(a)?this.expand(a,b):this.collapse(a,b)},isParentTree:function(a){return a.attr(s)===u},findParent:function(a){return a.parent(i).parent(j)},findLastListItem:function(a){return a.find(" > li:last-child")},findFirstListItem:function(a){return a.find(" > li:first-child")},findFirstListItemInSubList:function(a){return a.children(i).find(" > li:first-child")},identifyListItemWithChildren:function(a){this.collapse(a),a.addClass(E)},identifySubChildren:function(a,b,c){var d=a.children(i);d.length>0?(this.identifyListItemWithChildren(a),this.identifyChildren(d,w,c+1,b)):a.addClass(G)},identifyChildren:function(b,c,d){var e=this;b.attr(s,c);var f=b.children(j);f.attr(s,v).attr(t,d),f.each(function(){e.addIdToListItem(a(this),b,d),e.identifySubChildren(a(this),b,d)})},addIdToListItem:function(a,b){var c=this.generateListItemId(a,b);this.addIdAsDataOrId(a,c)},addIdAsDataOrId:function(a,b){var c=a.attr(k),d=b;c?(d=c,a.data(m,b)):a.attr(k,b),this.addIdToNodeLabel(a,d)},addIdToNodeLabel:function(a,b){var c=this.options.treeItemLabelSelector;if(c){var d=a.children(c),e=d.attr(k);e||d.attr(k,b+n)}},generateListItemId:function(a,b){var c;return c=0===b.parent(j).length?l+this.treeIdPiece+o:a.data(m)||b.parent(j).attr(k),c+"-"+b.children(j).index(a)}},a.fn[g]=function(b){return this.each(function(){a.data(this,h+g)||a.data(this,h+g,new e(this,b))})}}(jQuery,window,document);